# tsjson

Extract and manipulate parts of JSON files without touching the
formatting and comments in other parts.

## Installation

You can install the development version of tsjson from
[GitHub](https://github.com/) with:

``` r
# install.packages("pak")
pak::pak("gaborcsardi/tsjson")
```

## Documentation

See at
[`https://gaborcsardi.github.io/tsjson/`](https://gaborcsardi.github.io/tsjson/reference/index.html/)
and also in the installed package:
[`help(package = "tsjson")`](https://rdrr.io/pkg/tsjson/man).

## Quickstart

### Create a tsjson object

Create a tsjson object from a string:

``` r
txt <- r"(
// this is a comment
{
  "a": {
    "a1": [1, 2, 3],
    // comment
    "a2": "string"
  },
  "b": [
    {
      "b11": true,
      "b12": false
    },
    {
      "b21": false,
      "b22": false
    }
  ]
}
)"
json <- load_json(text = txt)
```

Pretty print a tsjson object:

``` r
json
```

    #> # json (19 lines)
    #>  1 | 
    #>  2 | // this is a comment
    #>  3 | {
    #>  4 |   "a": {
    #>  5 |     "a1": [1, 2, 3],
    #>  6 |     // comment
    #>  7 |     "a2": "string"
    #>  8 |   },
    #>  9 |   "b": [
    #> 10 |     {
    #> ℹ 9 more lines
    #> ℹ Use `print(n = ...)` to see more lines

### Select elements in a tsjson object

Select element by objects key:

``` r
select(json, "a")
```

    #> # json (19 lines, 1 selected element)
    #>    1  | 
    #>    2  | // this is a comment
    #>    3  | {
    #> >  4  |   "a": {
    #> >  5  |     "a1": [1, 2, 3],
    #> >  6  |     // comment
    #> >  7  |     "a2": "string"
    #> >  8  |   },
    #>    9  |   "b": [
    #>   10  |     {
    #>   11  |       "b11": true,
    #>   ...

Select element inside element:

``` r
select(json, "a", "a1")
```

    #> # json (19 lines, 1 selected element)
    #>   2   | // this is a comment
    #>   3   | {
    #>   4   |   "a": {
    #> > 5   |     "a1": [1, 2, 3],
    #>   6   |     // comment
    #>   7   |     "a2": "string"
    #>   8   |   },
    #>   ...

Select element(s) of an array:

``` r
select(json, "a", "a1", 1:2)
```

    #> # json (19 lines, 2 selected elements)
    #>   2   | // this is a comment
    #>   3   | {
    #>   4   |   "a": {
    #> > 5   |     "a1": [1, 2, 3],
    #>   6   |     // comment
    #>   7   |     "a2": "string"
    #>   8   |   },
    #>   ...

Select multiple keys from an object:

``` r
select(json, "a", c("a1", "a2"))
```

    #> # json (19 lines, 2 selected elements)
    #>    2  | // this is a comment
    #>    3  | {
    #>    4  |   "a": {
    #> >  5  |     "a1": [1, 2, 3],
    #>    6  |     // comment
    #> >  7  |     "a2": "string"
    #>    8  |   },
    #>    9  |   "b": [
    #>   10  |     {
    #>   ...

Select nodes that match a tree-sitter query:

``` r
json |> select_query("((pair value: (false) @val))")
```

    #> # json (19 lines, 3 selected elements)
    #>   ...
    #>    9  |   "b": [
    #>   10  |     {
    #>   11  |       "b11": true,
    #> > 12  |       "b12": false
    #>   13  |     },
    #>   14  |     {
    #> > 15  |       "b21": false,
    #> > 16  |       "b22": false
    #>   17  |     }
    #>   18  |   ]
    #>   19  | }

### Delete elements

Delete selected elements:

``` r
select(json, "a", "a1") |> delete_selected()
```

    #> # json (18 lines)
    #>  1 | 
    #>  2 | // this is a comment
    #>  3 | {
    #>  4 |   "a": {
    #>  5 |     // comment
    #>  6 |     "a2": "string"
    #>  7 |   },
    #>  8 |   "b": [
    #>  9 |     {
    #> 10 |       "b11": true,
    #> ℹ 8 more lines
    #> ℹ Use `print(n = ...)` to see more lines

### Insert elements

Insert element into an array:

``` r
select(json, "a", "a1") |> insert_into_selected(at = 2, "new")
```

    #> # json (24 lines)
    #>  1 | 
    #>  2 | // this is a comment
    #>  3 | {
    #>  4 |   "a": {
    #>  5 |     "a1": [
    #>  6 |         1,
    #>  7 |         2,
    #>  8 |         "new",
    #>  9 |         3
    #> 10 |     ],
    #> ℹ 14 more lines
    #> ℹ Use `print(n = ...)` to see more lines

Inserting into an array reformats the array.

Insert element into an object, at the specified key:

``` r
select(json, "a") |>
  insert_into_selected(key = "a0", at = 0, list("new", "element"))
```

    #> # json (27 lines)
    #>  1 | 
    #>  2 | // this is a comment
    #>  3 | {
    #>  4 |   "a": {
    #>  5 |       "a0": [
    #>  6 |           "new",
    #>  7 |           "element"
    #>  8 |       ],
    #>  9 |       "a1": [
    #> 10 |           1,
    #> ℹ 17 more lines
    #> ℹ Use `print(n = ...)` to see more lines

### Update elements

Update existing element:

``` r
select(json, "a", c("a1", "a2")) |> update_selected("new value")
```

    #> # json (19 lines)
    #>  1 | 
    #>  2 | // this is a comment
    #>  3 | {
    #>  4 |   "a": {
    #>  5 |     "a1": "new value",
    #>  6 |     // comment
    #>  7 |     "a2": "new value"
    #>  8 |   },
    #>  9 |   "b": [
    #> 10 |     {
    #> ℹ 9 more lines
    #> ℹ Use `print(n = ...)` to see more lines

Inserts the element if some parents are missing:

``` r
json <- load_json(text = "{ \"a\": { \"b\": true } }")
json
```

    #> # json (1 line)
    #> 1 | { "a": { "b": true } }

``` r
select(json, "a", "x", "y") |> update_selected(list(1,2,3))
```

    #> # json (10 lines)
    #>  1 | { "a": {
    #>  2 |     "b": true,
    #>  3 |     "x": {
    #>  4 |         "y": [
    #>  5 |             1,
    #>  6 |             2,
    #>  7 |             3
    #>  8 |         ]
    #>  9 |     }
    #> 10 | } }

# License

MIT © Posit Software, PBC

# Package index

## Quickstart

- See
  [quickstart](https://gaborcsardi.github.io/tsjson/reference/quickstart.md)
  for a quick demonstration of tsjson.
- See
  [`serialize_json()`](https://gaborcsardi.github.io/tsjson/reference/serialize_json.md)
  to create JSON from R.
- See
  [`unserialize_json()`](https://gaborcsardi.github.io/tsjson/reference/unserialize_json.md)
  to parse JSON into R.
- See
  [`load_json()`](https://gaborcsardi.github.io/tsjson/reference/load_json.md),
  [`select()`](https://gaborcsardi.github.io/tsjson/reference/select.md),
  and
  [`unserialize_selected()`](https://gaborcsardi.github.io/tsjson/reference/unserialize_selected.md)
  to parse parts of JSON into R.
- See
  [`load_json()`](https://gaborcsardi.github.io/tsjson/reference/load_json.md),
  [`select()`](https://gaborcsardi.github.io/tsjson/reference/select.md),
  [`format_selected()`](https://gaborcsardi.github.io/tsjson/reference/format_selected.md),
  and
  [`save_json()`](https://gaborcsardi.github.io/tsjson/reference/save_json.md)
  to format parts of a JSON file or string and save it to a file.
- See
  [`load_json()`](https://gaborcsardi.github.io/tsjson/reference/load_json.md),
  [`select()`](https://gaborcsardi.github.io/tsjson/reference/select.md),
  [`delete_selected()`](https://gaborcsardi.github.io/tsjson/reference/delete_selected.md),
  [`insert_into_selected()`](https://gaborcsardi.github.io/tsjson/reference/insert_into_selected.md),
  [`update_selected()`](https://gaborcsardi.github.io/tsjson/reference/update_selected.md),
  and
  [`save_json()`](https://gaborcsardi.github.io/tsjson/reference/save_json.md)
  to edit a JSON file or string and save it to a file.

## Serialization

- [`serialize_json()`](https://gaborcsardi.github.io/tsjson/reference/serialize_json.md)
  : Serialize an R object to JSON
- [`unserialize_json()`](https://gaborcsardi.github.io/tsjson/reference/unserialize_json.md)
  : Unserialize a JSON file or string into an R object

## Printing

- [`format(`*`<tsjson>`*`)`](https://gaborcsardi.github.io/tsjson/reference/format.tsjson.md)
  : Format a tsjson object
- [`print(`*`<tsjson>`*`)`](https://gaborcsardi.github.io/tsjson/reference/print.tsjson.md)
  : Print a tsjson object

## Extraction

- [`load_json()`](https://gaborcsardi.github.io/tsjson/reference/load_json.md)
  : Parse a JSON file or string into a tsjson object
- [`select()`](https://gaborcsardi.github.io/tsjson/reference/select.md)
  [`` `[[`( ``*`<tsjson>`*`)`](https://gaborcsardi.github.io/tsjson/reference/select.md)
  [`select_refine()`](https://gaborcsardi.github.io/tsjson/reference/select.md)
  : Select elements in a tsjson object
- [`select_query()`](https://gaborcsardi.github.io/tsjson/reference/select_query.md)
  : Select the nodes matching a tree-sitter query in a tsjson object

## Manipulation

- [`delete_selected()`](https://gaborcsardi.github.io/tsjson/reference/delete_selected.md)
  : Delete selected elements from a tsjson object
- [`` `select<-`() ``](https://gaborcsardi.github.io/tsjson/reference/select-set.md)
  [`` `[[<-`( ``*`<tsjson>`*`)`](https://gaborcsardi.github.io/tsjson/reference/select-set.md)
  : Update selected elements in a tsjson object
- [`format_selected()`](https://gaborcsardi.github.io/tsjson/reference/format_selected.md)
  : Format the selected JSON elements
- [`insert_into_selected()`](https://gaborcsardi.github.io/tsjson/reference/insert_into_selected.md)
  : Insert a new element into the selected ones in a tsjson object
- [`save_json()`](https://gaborcsardi.github.io/tsjson/reference/save_json.md)
  : Write a tsjson object to a file
- [`unserialize_selected()`](https://gaborcsardi.github.io/tsjson/reference/unserialize_selected.md)
  : Unserialize selected elements from a tsjson object
- [`update_selected()`](https://gaborcsardi.github.io/tsjson/reference/update_selected.md)
  : Replace selected JSON elements with a new element
- [`select()`](https://gaborcsardi.github.io/tsjson/reference/select.md)
  [`` `[[`( ``*`<tsjson>`*`)`](https://gaborcsardi.github.io/tsjson/reference/select.md)
  [`select_refine()`](https://gaborcsardi.github.io/tsjson/reference/select.md)
  : Select elements in a tsjson object

## Utilities and Options

- [`query_json()`](https://gaborcsardi.github.io/tsjson/reference/query_json.md)
  : Run tree-sitter queries on a JSON file or string
- [`sexpr_json()`](https://gaborcsardi.github.io/tsjson/reference/sexpr_json.md)
  : Show the syntax tree structure of a JSON file or string
- [`syntax_tree_json()`](https://gaborcsardi.github.io/tsjson/reference/syntax_tree_json.md)
  : Show the annotated syntax tree of a JSON file or string
- [`token_table()`](https://gaborcsardi.github.io/tsjson/reference/token_table.md)
  : Get the token table of a JSON file or string
- [`tsjson_options`](https://gaborcsardi.github.io/tsjson/reference/tsjson_options.md)
  : tsjson options
- [`` `[`( ``*`<tsjson>`*`)`](https://gaborcsardi.github.io/tsjson/reference/tsjson-brackets.md)
  : Convert a tsjson object to a data frame

